# 待优化事项 (TODO)

本文档记录已识别但尚未实施的优化点，供后续迭代参考。

---

## 架构优化

### 1. 引入 Repository 层解耦数据访问
**位置**: 所有 View 文件
**问题**: 各视图频繁直接调用 `self.controller.db`，与数据库实现强耦合
**建议**:
- 在 `main.py` (Controller) 中定义数据操作方法
- 或引入 Data Repository 层，让 View 通过统一接口获取数据
- 便于未来更换存储介质（如云端同步）

### 2. View 层职责瘦身
**位置**: `vocab_app/views/add_view.py` (Line 227-294)
**问题**: AddView 承担过多数据处理逻辑（聚合释义拼接、派生词保存等）
**建议**: 将多源数据聚合后的"保存前处理"逻辑移至 `MultiDictService` 或专门的控制器层

---

## 性能优化

### 3. 完善数据库分页
**位置**: `vocab_app/views/list_view.py`
**当前状态**: 已实现 `search_words()` 数据库层搜索，但对于"待复习"/"新单词"等状态仍需二次过滤
**建议**:
- 在数据库层增加对 `next_review_time` 的条件过滤
- 实现真正的数据库层分页，避免一次加载10000条记录

### 4. 词典缓存持久化
**位置**: `vocab_app/services/multi_dict_service.py`
**问题**: 当前缓存仅在内存中，重启应用后丢失
**建议**:
- 使用 SQLite 或本地文件持久化词典查询缓存
- 减少重复网络请求

---

## 用户体验

### 5. 释义高度自适应优化
**位置**: `vocab_app/views/add_view.py` (Line 485-511)
**问题**: 通过计算中文字符比例估算 Textbox 高度，不同 DPI/缩放比例下可能不准确
**建议**:
- 使用 `tk.Text` 的 `bbox` 方法获取实际像素高度
- 或改用透明 Label（支持自动换行和高度自适应）

### 6. 右键菜单选中反馈
**位置**: `vocab_app/views/list_view.py` (Line 463)
**问题**: 右键菜单弹出时没有高亮当前行
**建议**: 右键点击时先逻辑选中该行（视觉反馈），再弹出菜单

---

## 代码健壮性

### 7. 全局热键自动复制可配置
**位置**: `vocab_app/main.py` (Line 293)
**问题**: 全局热键触发时强制发送 `ctrl+c`，可能覆盖用户剪贴板
**建议**: 增加配置项允许用户关闭"自动复制"功能

### 8. 爬虫解析备用规则
**位置**: `vocab_app/services/dict_service.py` (Line 41-126)
**问题**: 有道词典 HTML 结构变动可能导致解析失效
**建议**:
- 为关键解析步骤增加多套备用选择器
- 考虑引入官方 API 作为备用

---

## 优先级建议

| 优先级 | 事项 | 难度 | 影响范围 |
|--------|------|------|----------|
| P1 | 完善数据库分页 | 中 | 大词库用户性能 |
| P1 | 引入 Repository 层 | 高 | 代码可维护性 |
| P2 | 右键菜单选中反馈 | 低 | 用户体验 |
| P2 | 全局热键可配置 | 低 | 用户体验 |
| P3 | 释义高度自适应 | 中 | 视觉一致性 |
| P3 | 词典缓存持久化 | 中 | 性能 |
| P3 | View 层职责瘦身 | 高 | 代码可维护性 |
| P3 | 爬虫备用规则 | 中 | 健壮性 |

---

*最后更新: 2026-01-18*
