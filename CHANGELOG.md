# 更新日志 (Changelog)

## v1.4 (2026-01-22)

### 新功能
- **标签筛选系统**:
  - 列表页新增标签筛选器，支持按考试标签(CET4/GRE/IELTS等)筛选单词
  - 标签筛选可与状态筛选(待复习/新单词)组合使用
  - 自动从数据库提取并聚合所有可用标签

### 用户体验优化
- **列表页悬停试听**:
  - 鼠标悬停在播放按钮上 500ms 后自动播放单词发音
  - 无需点击，快速浏览时听音更加流畅
  - 悬停离开自动取消播放，避免干扰
- **拼写模式自动发音**:
  - 进入拼写模式时自动播放单词发音
  - 支持听写练习 (Listen & Spell)
- **列表页交互优化**:
  - 修复键盘上下键导航时页面未跟随滚动的问题，现在焦点行会自动滚动到可见区域
  - 修复双击列表项偶发打开错误单词详情的 Bug (事件绑定闭包修复)

---

## v1.3 (2026-01-20)

### 用户体验优化
- **单词详情页自动播放发音**:
  - 打开单词详情页时自动播放发音
  - 切换上一个/下一个单词时自动播放发音
  - 无需手动点击播放按钮

- **复习结束统计面板**:
  - 复习完成后显示详细统计：用时、复习单词数、正确率
  - 分类统计：熟悉/模糊/忘记的单词数量
  - 根据正确率显示不同的鼓励语和emoji (🏆/🎉/💪/🌱)
  - 新增「结束复习」按钮，可随时停止复习并查看统计

---

## v1.2 (2026-01-18)

### 性能优化
- **数据库连接优化**:
  - 使用线程本地存储的长连接，避免频繁创建/关闭连接开销
  - 启用 SQLite WAL 模式，提升并发读写性能
  - 新增 `search_words()` 方法支持数据库层搜索和分页
- **列表搜索优化**:
  - `apply_filters()` 改用 SQLite LIKE 查询替代内存遍历
  - 大词库场景性能显著提升
- **网络请求优化**:
  - 使用共享 `requests.Session()` 复用 TCP 连接 (Keep-Alive)
  - 配置连接池 (10 connections, 20 max size)
  - 自动重试机制 (max_retries=2)

### 用户体验改进
- **拼写检查交互优化**:
  - 拼写检查后可点击任意处跳过等待，立即显示释义
  - 提示文本改为"点击任意处继续"，操作更直观

### Bug 修复与健壮性
- **Tooltip 悬浮提示修复**:
  - 修复鼠标移走后 Tooltip 仍然残留的问题
  - 添加 `-disabled` 属性防止 Tooltip 窗口拦截鼠标事件
  - 绑定窗口失焦、点击、widget 销毁事件确保正确隐藏
  - 缩短检查间隔 (200ms → 100ms)，响应更及时
- **词典服务健壮性**:
  - 增加索引越界检查，防止 HTML 结构变化导致崩溃
  - 使用 try-except 包裹所有可能的 IndexError/AttributeError

### 代码质量改进
- **代码结构优化**:
  - `review_view.py` 循环内的 `safe_play()` 函数改为类方法 `_safe_play_audio()`
  - 避免每次切换单词时重复创建函数对象

---

## v1.1 (2025-01-16)
- **详情页布局优化**:
  - 使用 CTkLabel 替代复杂的 Text widget，彻底修复卡片内大量空白的问题
  - 优化卡片布局，使用 grid 布局确保装饰条不会拉伸
  - 详情页窗口现已正确显示自定义 app.ico 图标
  - 播放按钮移至与单词、音标同一水平行
- **主界面卡片高度优化**:
  - 智能检测中英文比例，动态调整每行字符估算
  - 减少卡片间多余空白，界面更紧凑
- **Tooltip Bug 修复**:
  - 修复鼠标移开后 Tooltip 不消失的问题
  - 添加定时器每200ms检查鼠标位置
- **Bing 词典空格修复**:
  - 修复 Bing 词典例句和释义中单词间空格丢失的问题
  - 使用 `separator=' '` 参数保留 HTML 元素间距
- **例句样式调整**:
  - 移除例句的斜体样式，使用普通字体显示更清晰

---

## v1.0 正式版 (Legacy)
- **Tooltip 悬浮提示优化**:
  - 全新 Tooltip 组件，鼠标悬停侧边栏导航按钮和设置页面分类按钮时显示功能说明
  - 优化显示/隐藏逻辑，响应更灵敏
- **捐赠按钮视觉优化**:
  - 重新设计"请我喝杯咖啡"按钮，采用温暖橙色系
  - 固定按钮颜色，移除悬浮变色，避免视觉干扰
- **UI 细节打磨**:
  - 优化语境区域设计，自适应文本框高度
  - 来源语境区域视觉优化

---

## v3.3 (Legacy)
- **应用图标优化**:
  - 修复应用图标显示为默认 Tk 图标的问题，现正确加载自定义高清图标。
  - 调整图标加载优先级为 ICO 优先（Windows 兼容性更佳），PNG 作为降级方案。
  - 修复 `main.py` 中残留的错误缩进代码块导致的 `IndentationError` 启动崩溃。
- **右键查词优化**:
  - 修复选中文本包含标点符号（如 `word,` 或 `word.`）时音频下载失败的问题。
  - 新增 `clean_word()` 方法，自动清理文本首尾的标点符号，确保查询和音频下载使用纯净单词。
  - 修复 `detail_window.py` 详情窗口中音频播放和右键查词未清理标点的问题。
- **UI 视觉与品牌统一**:
  - 统一应用名称为"**智能生词本**"，标准侧边栏 Logo 及窗口标题。
  - 将"记单词"导航项重命名为"**词汇中心**" (Vocab Center)，重新定义核心搜词页面。
  - 同步更新应用内导航说明、热键提示及学习贴士。
- **首页 (仪表盘) 体验优化**:
  - 重构欢迎卡片：新增自适应时间问候语、精选励志金句，优化视觉层级与对比度。
  - 统计卡片增强：提升数据字号与间距，使词库总量、待复习数、已掌握数更直观。
  - 布局微调：调整搜词栏比例，优化底部"来源语境"区域的视觉融合度。
- **复习交互极致优化**:
  - **交互增强**：复习界面的释义及例句支持鼠标拖选复制，并适配右键菜单（支持快速复制、递归查词）。
  - **视觉体验**：优化复习页底部留白，修复拼写模式下超长释义显示截断的问题。
  - **逻辑引导**：明确初次进入复习页的引导逻辑，优化复习流程的初始状态。
- **开发者体验**:
  - 新增 `git_push.bat` 脚本，支持一键推送代码至 GitHub。
  - **代码重构**: 提取重复的右键菜单代码至 `BaseView`，删除约 60 行冗余代码；修复 `bare except` 静默失败问题，提升异常可追溯性。
  - **代码简化**: 优化 `review_view.py` 复习模式分发逻辑；统一词典源顺序 `SOURCE_ORDER` 常量；简化 `database.py` 数据库操作；合并 `tag_service.py` 正则逻辑。
  - **新增悬浮提示**: 侧边栏导航按钮和设置页面分类按钮添加 Tooltip，鼠标悬停显示功能说明。

## v3.2
- **健壮性优化**: 修复了由于有道词典连接超时/SSL错误导致的 `KeyError: 'date'` 崩溃问题；增强了数据库添加单词时的字段校验，支持所有字段缺省值。
- **Bug 修复**:
  - 修复 `DetailWindow` 中重复定义的 `delete_word` 方法导致删除功能失效的问题
  - 修复 `ReviewView` 复习队列的线程竞态问题，添加队列操作锁保护
  - 修复 `ReviewView` 事件处理器重复绑定导致的内存泄漏
  - 修复 `ReviewView` 中 6 个方法重复定义导致的代码冗余
  - 修复 `AddView` 重复搜索导致的并发写入问题，添加搜索锁
  - 修复 `AudioService` 文件删除时静默捕获所有异常的问题
  - 修复 `UpdateService` 版本比较时静默捕获异常的问题
  - 修复 `ListView` 和 `ReviewView` 中可能出现的 KeyError 空值访问问题
  - 修复 `ListView` 空列表提示中使用不存在的 `word_btn` 键导致的崩溃
  - 修复 `ReviewScheduler` 后台线程访问数据库的竞态条件
  - 修复 `main.py` 中 `reload_vocab_list()` 和 `quit_app()` 缺少异常保护的问题
  - 修复 `database.py` 中 11 个方法的数据库连接泄漏问题
- **搜索降级机制**: 完善了多词典查询的降级逻辑，当主要词典源（有道）不可用时，自动无缝切换至剑桥、Bing等备用源。
- **设置界面重构**: 采用侧边栏导航布局 (Sidebar Layout)，将设置项分类为统计、常规、词典、关于，优化视觉体验。
- **自动更新机制**: 实现基于 Bat 脚本替换的自更新流程 (Auto Update)，支持版本检测、自动下载、无缝替换重启。

## v3.1
- **派生词群组**: 内置40+常见词根库，自动识别词根并在详情页展示派生词群组，区分"已在词库"和"推荐添加"，支持一键跳转添加。
- **系统托盘**: 支持最小化到系统托盘，托盘菜单支持显示/复习/退出。
- **复习提醒**: 后台定时检查待复习单词并弹出 Windows 系统通知，可配置提醒间隔（15分钟~2小时或关闭）。
- **智能关闭**: 关闭窗口时弹出选择对话框（最小化到托盘/直接退出），支持"记住我的选择"，可在设置中随时修改。
- **系统行为设置**: 设置页面新增"系统行为"卡片，可配置关闭行为和复习提醒间隔。
- **多词典聚合**: 详情页支持 Bing 词典和 Free Dictionary API，分区块展示多词典释义，可在设置中开关各词典源。

## v3.0
- **架构改进**: 彻底完成代码拆分，实现模块化 (views/models/services)。
- **复习算法**: 实现了完整的 SuperMemo SM-2 算法。
- **学习热力图**: 在设置页面展示过去一年的复习热度。
- **单词详情**: 实现了独立的详情弹窗，支持内容复制和快捷查词。
- **批量删除**: 列表页支持多选批量删除单词。
- **导入导出**: 支持 CSV 格式的导入和导出。
- **自动化解析**: 自动解析并存储单词的词根、词缀及同近义词。
- **全局快捷键**: 实现了 `Ctrl+N/L/R/S` 快速切换页面。
- **主题适配**: 修复了深色模式下 Canvas 背景色不跟随主题的问题。
- **统一配置**: 使用 `config.json` 统一管理主题、快捷键等配置。
- **语境填空**: 实现了闪卡和拼写模式下的语境填空 (Cloze Deletion)。
